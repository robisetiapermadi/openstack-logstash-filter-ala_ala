  filter {

      if [fields][log_type] == "system.syslog" {
          grok {
          match => { "message" => "%{TIMESTAMP_ISO8601:[system][timestamp]}"}
        }


        # set timestamp
        date {
          match => [ "[system][timestamp]" , "ISO8601" ]
        }
        mutate {
          add_tag => [ "syslog" ]
        }
    
      }

      if [fields][log_type] == "system.auth" {
        grok {
          match => { "message" => "%{TIMESTAMP_ISO8601:[system][timestamp]}"}
        }


        # set timestamp
        date {
          match => [ "[system][timestamp]" , "ISO8601" ]
        }
        mutate {
          add_tag => [ "auth" ]
        }

        # get program name/pid
        grok {
          match => { "message" => "%{TIMESTAMP_ISO8601:temp} %{SYSLOGHOST:temp} %{DATA:[system][program]}?(\[%{POSINT:[system][pid]}\])?:"}
          remove_field => [ "temp" ]
        }

        if [system][program] =="sshd"{
            grok {
              patterns_dir   => ["etc/logstash/patterns.d"]
              match => { "message" => "%{SSH_AUTH_SUCCESS}" }
              add_field => { "[system][auth][result]" => "success" "[system][auth][type]" => "login" }
              #add_tag => [ "_grok_sshd_success", "matched" ]
              remove_field => [ "temp" ]
            }
            grok {
              patterns_dir   => ["etc/logstash/patterns.d"]
              match => { "message" => "%{SSH_AUTHFAIL_WRONGCREDS}" }
              add_field => { "[system][auth][result]" => "fail" "[system][auth][fail][reason]" => "wrong_credentials" "[system][auth][type]" => "login" }
              #add_tag => [ "_grok_sshd_success", "matched" ]
            }
            grok {
              patterns_dir   => ["etc/logstash/patterns.d"]
              match => { "message" => "%{SSH_AUTHFAIL_WRONGUSER}" }
              add_field => { "[system][auth][result]" => "fail" "[system][auth][fail][reason]" => "unknown_user" "[system][auth][type]" => "login" }
              #add_tag => [ "_grok_sshd_success", "matched" ]
            }
            grok {
              patterns_dir   => ["etc/logstash/patterns.d"]
              match => { "message" => "%{SSH_DISCONNECT}" }
              add_field => { "[system][auth][result]" => "success" "[system][auth][type]" => "logout" }
              add_tag => [ "_grok_sshd_success", "matched", "ssh_disconnect" ]
              remove_field => [ "temp" ]
            }
            mutate {
              remove_tag => [ "matched", "_grokparsefailure" ]
            }

            geoip {
		          source => "[system][auth][ip]"
              #add_field => [ "[geoip][location]", "%{[geoip][longitude]}" ]
              #add_field => [ "[geoip][location]", "%{[geoip][latitude]}"  ]
	          }
        }

        if [system][program] == "sudo" {
	        grok {
		        patterns_dir   => ["etc/logstash/patterns.d"]
		        match => { "message" => "%{SUDO}" }
		        add_tag => [ "_grok_sudo_success" ]
	        }
	      }

        if [system][program] == "su" {
	        grok {
		        patterns_dir   => ["etc/logstash/patterns.d"]
		        match => { "message" => "%{SU}" }
		        add_tag => [ "_grok_su_success" ]
	        }
	      }

        if [system][program] == "systemd-logind" {
	        grok {
		        patterns_dir   => ["etc/logstash/patterns.d"]
		        match => { "message" => "%{SYSTEMD_LOGIND}" }
		        add_tag => [ "_grok_systemd_logind_success" ]
	        }
	      }

        if [system][program] in [ "useradd", "groupadd" ] {
	        grok {
		        patterns_dir   =>["etc/logstash/patterns.d"]
            match => { "message" => "%{ACCOUNT_ADD}" }
            add_field => { "[system][user_management][account][action]" => "create" }
            add_tag => [ "_grok_new_account_success" ]
	        }
          if [system][user_management][account][kvdata]{
            mutate {
              gsub => [ "[system][user_management][account][kvdata]", ", ", '|' ]
            }
            kv {
              source => "[system][user_management][account][kvdata]"
              target => "[system][user_management][account][data]"
              field_split => "|"
            }
            mutate {

              remove_field => [ "[system][user_management][account][kvdata]" ]
            }
          }
	      }


        if [system][program] == "usermod" {
          grok {
            patterns_dir   => ["etc/logstash/patterns.d"]
            match => { "message" => "%{USERMOD}" }
            add_tag => [ "_grok_usermod_success" ]
          }
        }

        if [system][program] == "userdel" {
          grok {
            patterns_dir   => ["etc/logstash/patterns.d"]
            match => { "message" => "%{USERDEL}" }
            add_tag => [ "_grok_userdel_success" ]
          }
          mutate {
            gsub => [ "[system][user_management][account][action]", "remove", "delete" ]
          }
        }

        if [system][program] == "groupdel" {
            grok {
              patterns_dir   => ["etc/logstash/patterns.d"]
              match => { "message" => "%{GROUPDEL}" }
              add_field => { "[system][user_management][account][action]" => "delete" }
              add_tag => [ "_grok_groupdel_success" ]
            }
        }


      # end system.auth type
      }
  }